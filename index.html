<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Checklist Camion - Pulsanti Precisi Full con Presente/Assente e PDF</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f4; margin:0; padding:18px; color:#222; }
h1 { text-align:center; margin-bottom:14px; }
#layout { display:flex; gap:18px; flex-wrap:wrap; }
#left { flex:1; background:#fff; padding:14px; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.06); }
#right { flex:1; min-width:300px; position:relative; }
svg { width:100%; height:auto; display:block; border:1px solid #ccc; border-radius:6px; }
.hotspot-btn { position:absolute; background:rgba(255,255,255,0.3); border:1px solid #2196F3; border-radius:4px; cursor:pointer; font-weight:600; text-align:center; }
.blinking { animation: blink 1s infinite; }
@keyframes blink { 0%,100% {opacity:1;} 50% {opacity:0.3;} }
.compartimento { border:1px solid #ddd; margin:8px 0; border-radius:6px; overflow:hidden; }
.compartimento h3 { margin:0; padding:10px; background:#eee; cursor:pointer; }
.checklist { padding:10px; display:none; }
.checklist-item { display:flex; justify-content:space-between; align-items:center; margin:6px 0; padding:6px; border-radius:4px; }
.checklist-item.presente { background:#4CAF50; color:#fff; }
.checklist-item.assente { background:#f44336; color:#fff; }
label { margin-right:10px; cursor:pointer; }
#exportPDF { display:block; margin:12px auto; padding:8px 16px; font-weight:bold; cursor:pointer; }
</style>
</head>
<body>

<h1>Checklist Camion â€” Pulsanti Precisi Full con Presente/Assente</h1>

<!-- Bottone esportazione PDF -->
<button id="exportPDF">Esporta PDF Riepilogativo</button>

<div id="layout">
  <div id="left">
    <h2>Checklist</h2>
    <div id="camion"></div>
  </div>
  <div id="right">
    <svg id="camionSVG" viewBox="0 0 600 400">
      <image href="https://davide1499.github.io/prova-5/camion.jpg" x="0" y="0" width="600" height="400"/>
      <!-- Path tendine -->
      <path id="Cabina" d="M360,120 C370,115 468,115 468,120 L468,220 C468,225 370,225 360,220 Z" fill="rgba(0,0,0,0.1)"/>
      <path id="Anteriore Destro" d="M252,136 C260,130 348,130 348,136 L348,280 C348,285 260,285 252,280 Z" fill="rgba(0,0,0,0.1)"/>
      <path id="Centrale Destro" d="M164,136 C170,132 246,132 246,136 L246,236 C246,240 170,240 164,236 Z" fill="rgba(0,0,0,0.1)"/>
      <path id="Posteriore Destro" d="M75,136 C80,132 160,132 160,136 L160,272 C160,278 80,278 75,272 Z" fill="rgba(0,0,0,0.1)"/>
    </svg>
  </div>
</div>

<!-- Librerie jsPDF e html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<script>
const camionData = {
  "Cabina": ["Autoradio","Paletta Segnaletica","Nastro Segnaletico"],
  "Anteriore Destro": ["Pompa sommersa","Gruppo elettrogeno"],
  "Centrale Destro": ["3 Manichette alta pressione","7 Manichette UNI 45"],
  "Posteriore Destro": ["Premiscelatore di linea","Divisore 70/45"]
};

// Creazione UI checklist con Presente/Assente
function createCamionUI(){
  const camionDiv=document.getElementById("camion");
  camionDiv.innerHTML="";
  Object.keys(camionData).forEach(comp=>{
    const div=document.createElement("div");
    div.className="compartimento";
    const title=document.createElement("h3");
    title.textContent=comp;
    div.appendChild(title);

    const checklistDiv=document.createElement("div");
    checklistDiv.className="checklist";

    camionData[comp].forEach(item=>{
      const row=document.createElement("div");
      row.className="checklist-item";

      const label=document.createElement("span");
      label.textContent=item;

      const presLabel=document.createElement("label");
      presLabel.textContent="Presente ";
      const pres=document.createElement("input");
      pres.type="checkbox";
      presLabel.prepend(pres);

      const assLabel=document.createElement("label");
      assLabel.textContent="Assente ";
      const ass=document.createElement("input");
      ass.type="checkbox";
      assLabel.prepend(ass);

      pres.addEventListener('change', ()=>{
        if(pres.checked) ass.checked=false;
        row.classList.toggle('presente', pres.checked);
        row.classList.remove('assente');
      });
      ass.addEventListener('change', ()=>{
        if(ass.checked) pres.checked=false;
        row.classList.toggle('assente', ass.checked);
        row.classList.remove('presente');
      });

      const chkGroup=document.createElement("div");
      chkGroup.appendChild(presLabel);
      chkGroup.appendChild(assLabel);

      row.appendChild(label);
      row.appendChild(chkGroup);
      checklistDiv.appendChild(row);
    });

    div.appendChild(checklistDiv);
    camionDiv.appendChild(div);
  });
}

// Creazione pulsanti hotspot
function createHotspotButtons(){
  const svg=document.getElementById("camionSVG");
  const rightDiv=document.getElementById("right");
  Object.keys(camionData).forEach(comp=>{
    const path=svg.getElementById(comp);
    const btn=document.createElement("button");
    btn.className="hotspot-btn";
    btn.textContent=comp;
    btn.dataset.path = comp;
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.checklist').forEach(c=>c.style.display='none');
      const header=Array.from(document.querySelectorAll('.compartimento h3')).find(h=>h.textContent===comp);
      if(header) header.nextElementSibling.style.display='block';
      document.querySelectorAll('.hotspot-btn').forEach(b=>b.classList.remove('blinking'));
      btn.classList.add('blinking');
    });
    rightDiv.appendChild(btn);
    btn._targetPath = path;
  });
  updateHotspotPositions();
  window.addEventListener('resize', updateHotspotPositions);
}

// Posizionamento pulsanti sui path SVG
function updateHotspotPositions(){
  const svg=document.getElementById("camionSVG");
  const svgRect=svg.getBoundingClientRect();
  const scaleX=svgRect.width / svg.viewBox.baseVal.width;
  const scaleY=svgRect.height / svg.viewBox.baseVal.height;

  document.querySelectorAll('.hotspot-btn').forEach(btn=>{
    const bbox = btn._targetPath.getBBox();
    btn.style.left = `${bbox.x * scaleX}px`;
    btn.style.top  = `${bbox.y * scaleY}px`;
    btn.style.width = `${bbox.width * scaleX}px`;
    btn.style.height = `${bbox.height * scaleY}px`;
  });
}

// Funzione esportazione PDF
document.getElementById("exportPDF").addEventListener("click", async () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const checklistDiv = document.getElementById("camion");
  const canvas = await html2canvas(checklistDiv, { scale: 2 });
  const imgData = canvas.toDataURL("image/png");

  const pageWidth = doc.internal.pageSize.getWidth();
  const imgProps = doc.getImageProperties(imgData);
  const pdfHeight = (imgProps.height * pageWidth) / imgProps.width;

  doc.addImage(imgData, 'PNG', 0, 0, pageWidth, pdfHeight);
  doc.save("checklist_camion.pdf");
});

createCamionUI();
createHotspotButtons();
</script>

</body>
</html>